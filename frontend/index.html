<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cyberpunk Chat Client</title>
    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.16/dist/tailwind.min.css"
      rel="stylesheet"
    />
    <script src="https://unpkg.com/htmx.org@1.6.1"></script>
  </head>
  <body class="text-green-400 bg-black">
    <div class="container p-4 mx-auto">
      <h1 class="mb-4 font-mono text-4xl">Agent Chat</h1>
      <div
        id="chatBox"
        class="h-64 p-4 overflow-y-auto font-mono text-sm bg-gray-800 rounded shadow-lg"
      >
        <!-- Chat messages will be appended here -->
      </div>
      <form id="chatForm" class="mt-4">
        <input
          type="text"
          id="messageInput"
          class="w-full p-2 font-mono text-black rounded shadow"
          placeholder="Type your message..."
          required
        />
        <button
          type="submit"
          class="px-4 py-2 mt-2 font-bold text-black bg-green-500 rounded hover:bg-green-700"
        >
          Send
        </button>
      </form>
    </div>

    <script>
      let ws = new WebSocket("ws://localhost:8999/ws");
      let chatForm = document.getElementById("chatForm");
      let messageInput = document.getElementById("messageInput");

      ws.onopen = function () {
        ws.send(
          JSON.stringify({
            action: "startAgent",
            agent_name: "testagent",
            message: "awd",
          })
        );
      };

      ws.onmessage = function (event) {
        let chatBox = document.getElementById("chatBox");
        let message = document.createElement("p");
        console.log(event.data);
        message.textContent = "Agent: " + JSON.parse(event.data).message;
        chatBox.appendChild(message);
        chatBox.scrollTop = chatBox.scrollHeight;
      };

      chatForm.addEventListener("submit", function (event) {
        event.preventDefault();
        let message = messageInput.value;
        ws.send(
          JSON.stringify({
            action: "sendMessage",
            agent_name: "testagent",
            message: message,
          })
        );

        let chatBox = document.getElementById("chatBox");
        let userMessage = document.createElement("p");
        userMessage.textContent = "User: " + message;
        chatBox.appendChild(userMessage);
        chatBox.scrollTop = chatBox.scrollHeight;

        messageInput.value = "";
      });
    </script>
  </body>
</html>
